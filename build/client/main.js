!function(e){function t(t){for(var a,s,i=t[0],u=t[1],c=t[2],p=0,d=[];p<i.length;p++)s=i[p],r[s]&&d.push(r[s][0]),r[s]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(e[a]=u[a]);for(l&&l(t);d.length;)d.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,i=1;i<n.length;i++){var u=n[i];0!==r[u]&&(a=!1)}a&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={0:0},o=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var i=window.webpackJsonp=window.webpackJsonp||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var l=u;o.push([165,1]),n()}({165:function(e,t,n){e.exports=n(465)},465:function(e,t,n){"use strict";n.r(t),n(166),n(368),n(468);var a=n(1),r=n.n(a),o=n(160),i=n.n(o),u=(n(60),n(473)),c=n.n(u),l=n(10);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(){var e=function(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n    background-color: rgba(120,120,120,0.5);\n    padding:0;\n    font-size: 2em;\n    display: flex;\n    min-width: 60px;\n    text-align: center;\n    border-radius: 10px;\n    justify-content: center;\n    align-items: center;\n    height: 60px;\n    color:white;\n    margin-right:10px;\n    margin-top:10px;\n"]);return m=function(){return e},e}n(463);var v=l.a.div(m()),g=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,f(t).call(this))).state={showButton:!1},e}var n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,r.a.Component),n=t,(a=[{key:"componentDidMount",value:function(){this.props.getBusStopsInfo()}},{key:"componentWillUnmount",value:function(){}},{key:"selectHandler",value:function(e,t){document.querySelectorAll(".serviceTag").forEach(function(e){e.style.color="white"}),this.setState({showButton:!1}),this.props.selectorNamesHandler(t)}},{key:"clickHandler",value:function(e){var t=document.querySelectorAll(".serviceTag");"yellow"===e.target.style.color?(e.target.style.color="white",this.setState({showButton:!1})):(t.forEach(function(e){e.style.color="white"}),e.target.style.color="yellow",this.setState({showButton:!0})),this.props.clickAddServiceNoHandler(e)}},{key:"addPreferenceHandler",value:function(){Math.floor(100*Math.random()),this.props.addUserBusPreference(),this.setState={showButton:!1}}},{key:"render",value:function(){var e,t=this,n="";0<this.props.filteredBusStops.length&&(e=this.props.filteredBusStops.map(function(e,n){return r.a.createElement("option",{key:n,value:e.BusStopCode,onClick:function(n){return t.selectHandler(n,e.BusStopCode)}}," ",e.BusStopCode,", ",e.Description,", ",e.RoadName," ")}),n=r.a.createElement("label",null,r.a.createElement("p",null,"Select your location"),r.a.createElement("select",{size:"5"},e)));var a="";return this.props.data.Services&&(a=this.props.data.Services.map(function(e,n){return r.a.createElement(v,{className:"clickAdd serviceTag",key:n,onClick:function(e){return t.clickHandler(e)}},e.ServiceNo)})),r.a.createElement("div",{className:c.a.settingsPage},r.a.createElement("h3",null,"Add Preferences"),r.a.createElement("p",null,"Enter road names or bus stop names"),r.a.createElement("p",null,r.a.createElement("input",{type:"text",placeholder:"Address, bus stop number",onChange:function(e){return t.props.inputSearchNamesHandler(e)},value:this.props.inputSearchField})),n,r.a.createElement("div",{className:c.a.services_container}," ",a,this.state.showButton?r.a.createElement("button",{className:"clickAddButton",onClick:function(){return t.addPreferenceHandler()}}," Click to Add ➡️ "):null),r.a.createElement("div",{className:c.a.settingsBar},r.a.createElement("a",{href:"../login"},r.a.createElement("div",{className:c.a.fixedRight},r.a.createElement("img",{src:"https://res.cloudinary.com/djm7zwedb/image/upload/v1568095026/logout_gn64mc.svg",height:"30",width:"30"})))))}}])&&d(n.prototype,a),t}(),b=n(475),y=n.n(b);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(){var e=j(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567945544/weather_icons/rainy-7_wykft4.svg');\n    background-size: cover;\n    background-repeat: no-repeat;\n    background-position: top;\n    display: inline-block;\n    width:120px;\n    height: 120px;\n    margin:0;\n    padding:0;\n"]);return E=function(){return e},e}function x(){var e=j(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567945536/weather_icons/rainy-6_upmz1y.svg');\n    background-size: cover;\n    background-repeat: no-repeat;\n    background-position: top;\n    display: inline-block;\n    width:120px;\n    height: 120px;\n    margin:0;\n    padding:0;\n"]);return x=function(){return e},e}function B(){var e=j(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567945524/weather_icons/cloudy_jodffe.svg');\n    background-size: cover;\n    background-repeat: no-repeat;\n    background-position: top;\n    display: inline-block;\n    width:120px;\n    height: 120px;\n    margin:0;\n    padding:0;\n"]);return B=function(){return e},e}function O(){var e=j(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1568042268/weather_icons/haze_buixje.svg');\n    background-size: cover;\n    background-repeat: no-repeat;\n    background-position: top;\n    display: inline-block;\n    width:120px;\n    height: 120px;\n    margin:0;\n    padding:0;\n"]);return O=function(){return e},e}function N(){var e=j(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567946279/weather_icons/day_bsku0t.svg');\n    background-size: cover;\n    background-repeat: no-repeat;\n    background-position: top;\n    display: inline-block;\n    width:120px;\n    height: 120px;\n    margin:0;\n    padding:0;\n"]);return N=function(){return e},e}function j(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var T=l.a.div(N()),P=l.a.div(O()),R=l.a.div(B()),C=l.a.div(x()),D=l.a.div(E()),H=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,k(t).call(this))).state={weather24HrData:""},e}var n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,r.a.Component),n=t,(a=[{key:"componentDidMount",value:function(){this.get24HrWeatherForecast()}},{key:"componentWillUnmount",value:function(){}},{key:"getDateYYYYMMDD",value:function(){var e=new Date,t=""+(e.getMonth()+1),n=""+e.getDate(),a=e.getFullYear();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[a,t,n].join("-")}},{key:"get24HrWeatherForecast",value:function(){var e=this,t=this.getDateYYYYMMDD(),n=new XMLHttpRequest;n.addEventListener("load",function(){var t=JSON.parse(this.responseText);e.setState({weather24HrData:t.items[t.items.length-1]})}),n.open("GET","https://api.data.gov.sg/v1/environment/24-hour-weather-forecast?date="+t),n.setRequestHeader("accept","application/json"),n.send()}},{key:"ajaxSunriseSunset",value:function(){if(""!==this.state.latitude){var e="https://api.sunrise-sunset.org/json?lat="+this.state.latitude+"&lng="+this.state.longitude+"&date=today",t=new XMLHttpRequest;t.addEventListener("load",function(){var e=JSON.parse(this.responseText);this.calcTime(e)}),t.open("GET",e),t.setRequestHeader("accept","application/json"),t.send()}}},{key:"render",value:function(){var e="",t="",n="";if(this.state.weather24HrData)switch(t=r.a.createElement("div",null,r.a.createElement("p",{className:y.a.red},this.state.weather24HrData.general.temperature.high,"°C"),r.a.createElement("p",{className:y.a.blue},this.state.weather24HrData.general.temperature.low,"°C")),e=r.a.createElement("div",null," ",this.state.weather24HrData.general.forecast," "),this.state.weather24HrData.general.forecast){case"Fair & Warm":case"Fair":n=r.a.createElement(T,null);break;case"Hazy":case"Slightly Hazy":n=r.a.createElement(P,null);break;case"Partly Cloudy":n=r.a.createElement(R,null);break;case"Light Rain":case"Moderate Rain":case"Heavy Rain":case"Passing Showers":case"Light Showers":n=r.a.createElement(C,null);break;case"Showers":case"Heavy Showers":case"Thundery Showers":case"Heavy Thundery Showers":n=r.a.createElement(D,null);break;default:n=r.a.createElement(T,null)}return r.a.createElement("div",{className:y.a.weatherTile},r.a.createElement("div",{className:y.a.one_third},r.a.createElement("div",null,e)),n,r.a.createElement("div",{className:y.a.one_third},r.a.createElement("div",null,t)))}}])&&w(n.prototype,a),t}(),A=n(477),M=n.n(A);function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var F=function(e){function t(e){var n;return function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),(n=function(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,I(t).call(this,e))).state={date:new Date,time:new Date},n}var n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(t,r.a.Component),n=t,(a=[{key:"componentDidMount",value:function(){var e=this;this.divElement.clientHeight,this.timerID=setInterval(function(){return e.tick()},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerID)}},{key:"tick",value:function(){this.setState({time:new Date})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:M.a.timeTile,ref:function(t){return e.divElement=t}},r.a.createElement("div",null,r.a.createElement("div",{className:M.a.date},this.state.date.toLocaleDateString("en-SG",{weekday:"short",year:"numeric",month:"short",day:"numeric"})),r.a.createElement("div",{className:M.a.time},this.state.time.toLocaleTimeString())))}}])&&z(n.prototype,a),t}(),J=n(479),U=n.n(J);function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(){var e=oe(["\n    background-image: url('');\n    background-size: contain;\n    background-repeat: repeat-x;\n    background-position: top;\n    width: 40px;\n    height: 10px;\n    margin:0;\n    margin-top:10px;\n"]);return K=function(){return e},e}function Q(){var e=oe(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567936243/amberbar_elxpvy.svg');\n    background-size: contain;\n    background-repeat: repeat-x;\n    background-position: top;\n    width: 40px;\n    height: 10px;\n    margin:0;\n    margin-top:10px;\n"]);return Q=function(){return e},e}function $(){var e=oe(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567936773/greenbar_b12pjq.svg');\n    background-size: contain;\n    background-repeat: repeat-x;\n    background-position: top;\n    width: 40px;\n    height: 10px;\n    margin:0;\n    margin-top:10px;\n"]);return $=function(){return e},e}function V(){var e=oe(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567936243/redbar_wkdrnt.svg');\n    background-size: contain;\n    background-repeat: repeat-x;\n    background-position: top;\n    width: 40px;\n    height: 10px;\n    margin:0;\n    margin-top:10px;\n"]);return V=function(){return e},e}function Z(){var e=oe(["\n    background-image: url('');\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    margin-left: 5px;\n    width: 25px;\n    height: 25px;\n"]);return Z=function(){return e},e}function ee(){var e=oe(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567933516/WABwhite_nyzc5d.svg');\n    background-size: contain;\n    background-repeat: no-repeat;\n    margin-left: 5px;\n    width: 25px;\n    height: 25px;\n"]);return ee=function(){return e},e}function te(){var e=oe(["\n    background-image: url('');\n    background-size: contain;\n    background-repeat: no-repeat;\n    margin-left: 5px;\n    width: 40px;\n    height: 30px;\n    margin:0;\n"]);return te=function(){return e},e}function ne(){var e=oe(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567933726/BD_ezpspd.svg');\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: bottom;\n    margin-left: 5px;\n    width: 40px;\n    height: 30px;\n    margin:0;\n"]);return ne=function(){return e},e}function ae(){var e=oe(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567933727/DD_qu69xm.svg');\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: bottom;\n    width: 40px;\n    height: 30px;\n    margin:0;\n"]);return ae=function(){return e},e}function re(){var e=oe(["\n    background-image: url('https://res.cloudinary.com/djm7zwedb/image/upload/v1567933727/SD_ms8swe.svg');\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: bottom;\n    width: 40px;\n    height: 30px;\n    margin:0;\n"]);return re=function(){return e},e}function oe(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var se=l.a.div(re()),ie=l.a.div(ae()),ue=l.a.div(ne()),ce=l.a.div(te()),le=l.a.div(ee()),pe=l.a.div(Z()),de=l.a.div(V()),fe=l.a.div($()),he=l.a.div(Q()),me=l.a.div(K()),ve=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,X(t).call(this))).state={data:[],updated:!1},e}var n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(t,r.a.Component),n=t,(a=[{key:"componentDidMount",value:function(){var e=this;this.getBusArrival(),this.interval=setInterval(function(){return e.getBusArrival()},6e4)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"distance",value:function(e,t,n,a){var r=(a-t)*Math.PI/180,o=(n-e)*Math.PI/180,s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2),i=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371,u=1e3*i/1.25/60;return u=u<1?"< 2mins walk":u<8?"~"+(u=Math.ceil(1.1*u))+"mins walk":u<12?"~"+(u=Math.ceil(1.2*u))+"mins walk":"~"+(u=Math.ceil(1.3*u))+"mins walk",i<1?(i=Math.round(1e3*i))+"m, "+u:i<2?(i=Math.round(100*i)/100)+"km, "+u:i<10?(i=Math.round(100*i)/100)+"km":(i=Math.round(10*i)/10)+"km"}},{key:"getBusArrival",value:function(){var e=this,t=new XMLHttpRequest,n="https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2?BusStopCode="+this.props.busPref.busstopcode;this.props.busPref.serviceno&&(n+="&ServiceNo="+this.props.busPref.serviceno),t.addEventListener("load",function(){var t=JSON.parse(this.responseText);0<t.Services.length&&(e.setState({data:t.Services[0]}),e.setState({updated:!0}))}),t.open("GET",n),t.setRequestHeader("AccountKey","o73n5Dg0SfWF32z1JpnyuQ=="),t.setRequestHeader("accept","application/json"),t.send()}},{key:"parseTime",value:function(e){var t=(new Date).getTime(),n=new Date(e).getTime(),a=Math.abs(n-t)/1e3/60;return a<1?r.a.createElement("div",{className:U.a.arrivalARR}," ARR "):isNaN(a)?r.a.createElement("div",{className:U.a.arrivalARR}," No Est "):r.a.createElement("div",null,r.a.createElement("div",{className:U.a.arrivalText}," ",Math.floor(a)," "),r.a.createElement("div",{className:U.a.minute},"min"))}},{key:"loadBusTypeIcon",value:function(e){return"SD"===e?r.a.createElement(se,null):"DD"===e?r.a.createElement(ie,null):"BD"===e?r.a.createElement(ue,null):r.a.createElement(ce,null)}},{key:"loadBusWABIcon",value:function(e){return"WAB"===e?r.a.createElement(le,null):r.a.createElement(pe,null)}},{key:"loadBusLoad",value:function(e){return"SEA"===e?r.a.createElement(fe,null):"SDA"===e?r.a.createElement(he,null):"LSD"===e?r.a.createElement(de,null):r.a.createElement(me,null)}},{key:"render",value:function(){var e=this,t=this.distance(this.props.longitude,this.props.latitude,this.props.busPref.longitude,this.props.busPref.latitude),n="",a="",o="",s="",i="",u="",c="",l="",p="",d="",f="",h="";return this.state.updated&&(n=this.parseTime(this.state.data.NextBus.EstimatedArrival),a=this.parseTime(this.state.data.NextBus2.EstimatedArrival),o=this.parseTime(this.state.data.NextBus3.EstimatedArrival),s=this.loadBusTypeIcon(this.state.data.NextBus.Type),i=this.loadBusTypeIcon(this.state.data.NextBus2.Type),u=this.loadBusTypeIcon(this.state.data.NextBus3.Type),c=this.loadBusWABIcon(this.state.data.NextBus.Feature),l=this.loadBusWABIcon(this.state.data.NextBus2.Feature),p=this.loadBusWABIcon(this.state.data.NextBus3.Feature),d=this.loadBusLoad(this.state.data.NextBus.Load),f=this.loadBusLoad(this.state.data.NextBus2.Load),h=this.loadBusLoad(this.state.data.NextBus3.Load)),r.a.createElement("div",{className:U.a.busTile},r.a.createElement("div",{className:U.a.settingsBar},r.a.createElement("div",{className:U.a.fixedRight,onClick:function(t){e.props.deleteUserBusPreference(t)}},r.a.createElement("img",{"data-id":this.props.busPref.id,src:"https://res.cloudinary.com/djm7zwedb/image/upload/v1568095868/closeXgrey_ruhlwz.svg",height:"15",width:"15"}))),r.a.createElement("p",null,r.a.createElement("span",null,r.a.createElement("b",null,this.props.busPref.description)," "),"|",r.a.createElement("span",null," ",this.props.busPref.roadname," "),"|",r.a.createElement("small",null," ",this.props.busPref.busstopcode,", ",t," ")," "),r.a.createElement("div",{className:U.a.arrival_container},r.a.createElement("div",{className:U.a.serviceNo,onClick:function(){return e.getBusArrival()}},r.a.createElement("div",null,this.props.busPref.serviceno)),r.a.createElement("div",{className:U.a.arrivalTag},n),r.a.createElement("div",{className:U.a.busTag},s,d),c,r.a.createElement("div",{className:U.a.arrivalTag},a),r.a.createElement("div",{className:U.a.busTag},i,f),l,r.a.createElement("div",{className:U.a.arrivalTag},o),r.a.createElement("div",{className:U.a.busTag},u,h),p))}}])&&Y(n.prototype,a),t}(),ge=n(481),be=n.n(ge);function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function we(e){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _e=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,we(t).call(this))).state={inputSearchField:"",serviceNo:"",data:"",busServicesAvailableAtBusCode:"",busStops:[],busRoutes:[],busServices:[],busStopsCounter:0,busRoutesCounter:0,busServicesCounter:0,endOfArray:!1,busStopCode:"",filteredBusStops:[],latitude:"",longitude:"",time:"",busPref:[],showSettings:!1,loadingBusStopInfo:!1},e}var n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(t,r.a.Component),n=t,(a=[{key:"componentDidMount",value:function(){this.getBusStopsInfo(),this.getCoordinates(),this.getUserBusPreference()}},{key:"componentWillUnmount",value:function(){}},{key:"inputSearchNamesHandler",value:function(e){this.setState({inputSearchField:e.target.value}),this.setState({data:""});var t=e.target.value.toString(),n=this.state.busStops.filter(function(e){return e.RoadName.toLowerCase().includes(t)||e.Description.toLowerCase().includes(t)||e.BusStopCode.includes(t)});this.setState({filteredBusStops:n}),0<n.length&&this.setState({busStopCode:n[0].BusStopCode})}},{key:"findBusInfo",value:function(e){var t=e.toString();return this.state.busStops.filter(function(e){return e.RoadName.toLowerCase().includes(t)||e.Description.toLowerCase().includes(t)||e.BusStopCode.includes(t)})[0]}},{key:"selectorNamesHandler",value:function(e){this.setState({busStopCode:e}),this.ajaxBusAvailable(e)}},{key:"clearSettingsInput",value:function(){this.setState({inputSearchField:""}),this.setState({filteredBusStops:[]}),this.setState({data:""})}},{key:"clickAddServiceNoHandler",value:function(e){var t=e.target.innerText;this.state.serviceNo===t?this.setState({serviceNo:""}):this.setState({serviceNo:t})}},{key:"parseTime",value:function(e){var t=(new Date).getTime(),n=new Date(e).getTime(),a=Math.abs(n-t)/1e3/60;return a<1?"ARR":isNaN(a)?"NA":Math.floor(a)}},{key:"fetchUserName",value:function(){var e=document.cookie.split("=");return e[e.length-1]}},{key:"getCoordinates",value:function(){var e=this;navigator.geolocation.getCurrentPosition(function(t){var n=t.coords;e.setState({latitude:n.latitude}),e.setState({longitude:n.longitude})},function(e){},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}},{key:"getDateYYYYMMDD",value:function(){var e=new Date,t=""+(e.getMonth()+1),n=""+e.getDate(),a=e.getFullYear();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[a,t,n].join("-")}},{key:"addUserBusPreference",value:function(){var e=this,t=this.findBusInfo(e.state.busStopCode),n={username:this.fetchUserName(),busstopcode:e.state.busStopCode,serviceno:e.state.serviceNo,roadname:t.RoadName,description:t.Description,latitude:t.Latitude,longitude:t.Longitude},a=new XMLHttpRequest;a.addEventListener("load",function(){e.getUserBusPreference(),e.clearSettingsInput(),e.setState({showSettings:!1})}),a.open("POST","./data/buspreference"),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(JSON.stringify(n))}},{key:"getUserBusPreference",value:function(){var e=this,t={username:e.fetchUserName()},n=new XMLHttpRequest;n.addEventListener("load",function(){var t=JSON.parse(this.responseText);e.setState({busPref:t.results}),0===e.state.busPref.length&&e.setState({showSettings:!0})}),n.open("GET","./data/"+e.fetchUserName()),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify(t))}},{key:"deleteUserBusPreference",value:function(e){var t=e.target.dataset.id,n=this,a={username:n.fetchUserName(),id:t},r=new XMLHttpRequest;r.addEventListener("load",function(){n.getUserBusPreference()}),r.open("DELETE","./data/"+n.fetchUserName()+"/"+t),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(a))}},{key:"getBusArrival",value:function(e,t,n){var a=this,r=new XMLHttpRequest,o="https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2?BusStopCode="+t;n&&(o+="&ServiceNo="+n),r.addEventListener("load",function(){var t=JSON.parse(this.responseText),n=Object.assign({},t.Services[0],a.state.busPref[e]),r=a.state.busPref;r[e]=n,a.setState({busPref:r})}),r.open("GET",o),r.setRequestHeader("AccountKey","o73n5Dg0SfWF32z1JpnyuQ=="),r.setRequestHeader("accept","application/json"),r.send()}},{key:"ajaxBusAvailable",value:function(e){var t=this,n=new XMLHttpRequest,a="https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2?BusStopCode="+e;n.addEventListener("load",function(){var e=JSON.parse(this.responseText);e.Services.sort(function(e,t){return parseInt(e.ServiceNo)>parseInt(t.ServiceNo)?1:-1}),t.setState({data:e})}),n.open("GET",a),n.setRequestHeader("AccountKey","o73n5Dg0SfWF32z1JpnyuQ=="),n.setRequestHeader("accept","application/json"),n.send()}},{key:"ajaxBusRoutes",value:function(){var e=this;if(null===window.localStorage.getItem("busRoutes1")){var t="";if(!e.state.endOfArray){0<e.state.busRoutesCounter&&(t="?$skip="+500*e.state.busRoutesCounter);var n=new XMLHttpRequest,a="https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/BusRoutes"+t;n.addEventListener("load",function(){var t=JSON.parse(this.responseText);if(e.setState({busRoutes:e.state.busRoutes.concat(t.value)}),e.setState({busRoutesCounter:e.state.busRoutesCounter+1}),0===t.value.length){e.setState({endOfArray:!0});var n=e.state.busRoutes,a=n.splice(0,Math.ceil(n.length/2));n.splice(0,Math.ceil(n.length/2)),a.splice(0,Math.ceil(n.length/2)),window.localStorage.setItem("busRoutes1",JSON.stringify(n)),window.localStorage.setItem("busRoutes1a",JSON.stringify(a)),window.localStorage.setItem("busRoutes2",JSON.stringify(a)),window.localStorage.setItem("busRoutes2a",JSON.stringify(a))}e.state.endOfArray||e.ajaxBusRoutes()}),n.open("GET",a),n.setRequestHeader("AccountKey","o73n5Dg0SfWF32z1JpnyuQ=="),n.setRequestHeader("accept","application/json"),n.send()}}else{var r=e.retrieveLocalData("busRoutes1"),o=e.retrieveLocalData("busRoutes1"),s=e.retrieveLocalData("busRoutes2"),i=e.retrieveLocalData("busRoutes2");e.setState({busRoutes:r.concat(o,s,i)})}}},{key:"getBusStopsInfo",value:function(){var e=this;if(e.setState({loadingBusStopInfo:!0}),null===window.localStorage.getItem("busStopCodes")){console.log("no bus info detected on localstorage");var t="";if(e.state.endOfArray)e.setState({loadingBusStopInfo:!1});else{0<e.state.busStopsCounter&&(t="?$skip="+500*e.state.busStopsCounter);var n=new XMLHttpRequest,a="https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/BusStops"+t;n.addEventListener("load",function(){var t=JSON.parse(this.responseText);e.setState({busStops:e.state.busStops.concat(t.value)}),e.setState({busStopsCounter:e.state.busStopsCounter+1}),0===t.value.length&&(e.setState({endOfArray:!0}),e.setState({loadingBusStopInfo:!1}),e.storeLocalData("busStopCodes",e.state.busStops)),e.state.endOfArray||e.getBusStopsInfo()}),n.open("GET",a),n.setRequestHeader("AccountKey","o73n5Dg0SfWF32z1JpnyuQ=="),n.setRequestHeader("accept","application/json"),n.send()}}else{var r=e.retrieveLocalData("busStopCodes");e.setState({busStops:r}),e.setState({loadingBusStopInfo:!1})}}},{key:"storeLocalData",value:function(e,t){window.localStorage.setItem(e,JSON.stringify(t))}},{key:"retrieveLocalData",value:function(e){var t=window.localStorage.getItem(e);return JSON.parse(t)}},{key:"settingsHandler",value:function(){this.setState({showSettings:!this.state.showSettings}),window.scrollTo(0,0)}},{key:"ajaxPumpData",value:function(e){var t={data:e},n=JSON.stringify(t),a=new XMLHttpRequest;a.addEventListener("load",function(){console.log("ajax response handler function")}),a.open("POST","./secret"),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(n)}},{key:"ajaxWeather2HrForecast",value:function(){var e=this,t=this.getDateYYYYMMDD(),n=new XMLHttpRequest;n.addEventListener("load",function(){var t=JSON.parse(this.responseText),n=t.area_metadata,a=[];for(var r in n)a.push(n[r].name);e.setState({locations:a}),e.setState({weather2HrData:t.items[t.items.length-1]})}),n.open("GET","https://api.data.gov.sg/v1/environment/2-hour-weather-forecast?date="+t),n.setRequestHeader("accept","application/json"),n.send()}},{key:"ajaxBusServices",value:function(){console.log("ajax bus services");var e=this;if(null===window.localStorage.getItem("busServices")){console.log("no bus Services detected on localstorage ",e.state.busServicesCounter);var t="";if(e.state.endOfArray)console.log("end of array : unable to proceed");else{0<e.state.busServicesCounter&&(t="?$skip="+500*e.state.busServicesCounter);var n=new XMLHttpRequest,a="https://cors-anywhere.herokuapp.com/http://datamall2.mytransport.sg/ltaodataservice/BusServices"+t;n.addEventListener("load",function(){s;var t=JSON.parse(this.responseText);e.setState({busServices:e.state.busServices.concat(t.value)}),e.setState({busServicesCounter:e.state.busServicesCounter+1}),0===t.value.length&&(e.setState({endOfArray:!0}),console.log("All Bus Services Fully Loaded"),e.storeLocalData("busServices",e.state.busServices)),e.state.endOfArray||e.ajaxBusServices()}),n.open("GET",a),n.setRequestHeader("AccountKey","o73n5Dg0SfWF32z1JpnyuQ=="),n.setRequestHeader("accept","application/json"),n.send()}}else{var r=e.retrieveLocalData("busServices");e.setState({busServices:r}),console.log("copied from local storage")}}},{key:"checkBusStopCodesForServiceNo",value:function(e){var t=this.state.busRoutes.filter(function(t){return t.BusStopCode==e});this.setState({busServicesAvailableAtBusCode:t})}},{key:"render",value:function(){var e=this,t="";return null!=this.state.busPref&&0<this.state.busPref.length&&(t=this.state.busPref.map(function(t,n){return r.a.createElement(ve,{key:n,busPref:e.state.busPref[n],latitude:e.state.latitude,longitude:e.state.longitude,deleteUserBusPreference:function(t){return e.deleteUserBusPreference(t)}})})),r.a.createElement("div",null,r.a.createElement("div",{className:be.a.settingsBar},r.a.createElement("img",{className:be.a.fixedright,src:"https://res.cloudinary.com/djm7zwedb/image/upload/v1568084559/settingsblack_i6dlyw.svg",height:"30",width:"30",onClick:function(){return e.settingsHandler()}})),this.state.showSettings?r.a.createElement(g,{inputSearchNamesHandler:function(t){return e.inputSearchNamesHandler(t)},inputSearchField:this.state.inputSearchField,selectorNamesHandler:function(t){return e.selectorNamesHandler(t)},filteredBusStops:this.state.filteredBusStops,data:this.state.data,clickAddServiceNoHandler:function(t){return e.clickAddServiceNoHandler(t)},addUserBusPreference:function(){return e.addUserBusPreference()},getBusStopsInfo:function(){return e.getBusStopsInfo()}}):null,this.state.loadingBusStopInfo?r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("h2",{"data-text":"Loading..."},"Loading...")):null,r.a.createElement(F,null),r.a.createElement(H,null),t)}}])&&Se(n.prototype,a),t}(),Ee=n(483),xe=n.n(Ee);function Be(e){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function je(e,t){return(je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Te=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==Be(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}(this,Ne(t).call(this))).state={},e}var n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&je(e,t)}(t,r.a.Component),n=t,(a=[{key:"render",value:function(){return r.a.createElement("div",{className:xe.a.main_container},r.a.createElement("div",{className:xe.a.app_container},r.a.createElement(_e,null)))}}])&&Oe(n.prototype,a),t}();i.a.render(r.a.createElement(Te,null),document.getElementById("app"))},473:function(e,t){e.exports={settingsPage:"style_settingsPage_2d387",services_container:"style_services_container_5dec8",clickAddButton:"style_clickAddButton_a9bbd",settingsBar:"style_settingsBar_52d3d",fixedRight:"style_fixedRight_1795e"}},475:function(e,t){e.exports={weatherTile:"style_weatherTile_07014",one_third:"style_one_third_31ddb",red:"style_red_2b9dc",blue:"style_blue_063ac"}},477:function(e,t){e.exports={timeTile:"style_timeTile_bdde4",time:"style_time_29006",date:"style_date_2405e"}},479:function(e,t){e.exports={busTile:"style_busTile_1798e",serviceNo:"style_serviceNo_ca864",arrival_container:"style_arrival_container_ac4c5",arrivalTag:"style_arrivalTag_408e8",busTag:"style_busTag_5a6b7",arrivalText:"style_arrivalText_7bf58",arrivalTextARR:"style_arrivalTextARR_7f0a9",minute:"style_minute_d5b8d",settingsBar:"style_settingsBar_65cc0",fixedRight:"style_fixedRight_5bb45"}},481:function(e,t){e.exports={desc:"style_desc_f363e",settingsBar:"style_settingsBar_92534",fixedright:"style_fixedright_32e1a",loading:"style_loading_87e48"}},483:function(e,t){e.exports={main_container:"style_main_container_c0450",app_container:"style_app_container_85e7a"}}});